;; Configuration
;; for further configuration see scripts/parse_workspaces.py
;; where you can set your icons

;; Enables process name preview on selected workspace
(defvar enable_process_name false)

;; Shows the workspace number beside the icon
(defvar enable_workspace_number true)

;; Enables multiple icon previews per workspace
(defvar enable_multiple_icons true)

;; Implementation
(defpoll workspace_str
    :interval "0.1s"
    :initial_value "[]"
    "$HOME/.config/eww/scripts/parse_workspaces.py")

(defwidget workspaces []
    (box
        :spacing 16
        :halign "center"
        :orientation "h"
        :space-evenly false
        :valign "center"
        (for workspace in workspace_str
            (eventbox
                :cursor "pointer"
                :onclick "wmctrl -s ${workspace.workspace}"
                (box
                    :spacing 10
                    :space-evenly false
                    :hexpand false
                    :vexpand false
                    :halign "center"
                    :valign "center"
                    :class "${workspace.current ? 'selected' : 'not-selected'}"
                    (for icon in
                        "${enable_multiple_icons ? '${jq(workspace, '.icons')}' : '[${jq(workspace, '.icons[0]')}]'}"
                        (label
                            :class "icon"
                            :text icon))
                    (label
                        :class "number"
                        :text "${enable_workspace_number ? '${workspace.workspace + 1}' : ''}")
                    (label
                        :class "process"
                        :text "${enable_process_name && workspace.current ? ' - ${workspace.process}' : ''}"))))))

(defwindow workspaces
    :monitor 0
    :geometry (geometry :x "0%"
                        :y "10px"
                        :width "35%"
                        :height "35px"
                        :anchor "top center")
    :stacking "fg"
    :reserve (struts :distance "40px" :side "top")
    :windowtype "dock"
    :wm-ignore true
    (workspaces))
